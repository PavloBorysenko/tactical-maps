# Observer Viewer Page

Страница для отображения карты observer'а с панелью инструментов и активными объектами.

## Как работает

### Доступ

-   Страница доступна по URL: `/observer/{token}`
-   Где `{token}` - это access token observer'а
-   Не требует авторизации - доступ только по токену

### Функциональность

#### Отображение информации observer'а:

-   **Имя observer'а** с иконкой (если есть)
-   **Описание observer'а** (если есть)
-   **Название карты** которую наблюдает observer
-   **Количество активных объектов** на карте
-   **Время подключения** observer'а

#### Карта:

-   Отображает карту, назначенную observer'у
-   Показывает все **активные объекты** (с действующим TTL)
-   Использует существующий компонент `mapViewer.js`
-   Включает панель инструментов карты
-   Responsive дизайн для мобильных устройств

#### Активные объекты:

-   Отображаются только объекты с **актуальным TTL**
-   Используется метод `GeoObjectRepository::findActiveByMap()`
-   Объекты без TTL (null) отображаются всегда
-   Объекты с истекшим TTL скрываются

## Доступ из админ панели

### Из списка observers:

-   Кнопка **"View Map"** в колонке Actions
-   Открывается в новой вкладке

### Со страницы observer'а:

-   Кнопка **"View Observer Map"** в разделе Actions
-   Открывается в новой вкладке

## Технические детали

### Контроллер

-   `App\Controller\ObserverViewerController`
-   Метод `view()` принимает токен
-   Проверяет валидность токена
-   Получает активные объекты карты

### Шаблон

-   `templates/observer_viewer/view.html.twig`
-   Использует существующие JS компоненты
-   Современный gradient дизайн
-   Responsive layout

### Безопасность

-   Доступ только по валидному токену
-   Отображает только объекты назначенной карты
-   Нет возможности редактирования

## Будущие улучшения

### Rules System (планируется):

-   Фильтрация объектов по правилам observer'а
-   Скрытие/показ объектов по типам
-   Ограничения видимости по сторонам
-   Временные ограничения просмотра

### API Integration (планируется):

-   REST API для получения данных
-   WebSocket для real-time обновлений
-   Mobile app интеграция

## Маршруты

```php
GET /observer/{token} - observer_viewer
```

## Пример использования

1. Админ создает observer'а в админ панели
2. Копирует access token observer'а
3. Передает токен пользователю
4. Пользователь заходит по URL: `/observer/ACCESS_TOKEN`
5. Видит назначенную карту с активными объектами

## Файловая структура

```
src/
├── Controller/
│   └── ObserverViewerController.php
templates/
├── observer_viewer/
│   └── view.html.twig
├── observer/
│   ├── index.html.twig (добавлена кнопка View Map)
│   └── show.html.twig (добавлена кнопка View Map)
```

## Стили

Все стили инлайновые в шаблоне для простоты:

-   **Observer info panel** - gradient background
-   **Map container** - 70vh высота с тенью
-   **Observer stats** - информационные блоки
-   **Map info bar** - информация о карте

## Зависимости

-   Существующий `mapViewer.js` компонент
-   Bootstrap 5 для responsive дизайна
-   FontAwesome для иконок
-   Leaflet для отображения карты
